name: OWASP ZAP Security Scan

on: [push, pull_request]

jobs:
  zap-scan:
    runs-on: ubuntu-latest
    timeout-minutes: 60  # é˜²æ­¢CIé˜»å¡

    steps:
      - name: ğŸ› ï¸ Checkout with Submodules
        uses: actions/checkout@v4
        with:
          submodules: recursive  # ç¡®ä¿åŒ…å«.zapé…ç½®ç›®å½•
          fetch-depth: 0

      - name: ğŸ¯ Health Check
        uses: wei/curl@v1.7
        with:
          args: -X HEAD --retry 3 --retry-delay 10 http://47.129.5.86:8080

      - name: ğŸ” Full Security Scan
        uses: zaproxy/action-full-scan@v1.6.0  # Marketplaceå®˜æ–¹è®¤è¯
        with:
          target: 'http://47.129.5.86:8080'
          format: 'html'  # æ”¯æŒhtml/json/mdä¸‰ç§æ ¼å¼
          rules: 'media/conf/zap/rules.tsv'  # è‡ªå®šä¹‰è§„åˆ™è·¯å¾„
          cmd_options: '-I -T 180'  # é«˜çº§å‚æ•°ï¼š
          # -I: å¿½ç•¥è­¦å‘Š
          # -T: è¶…æ—¶æ—¶é—´(ç§’)
          # -J: ç”Ÿæˆè¶‹åŠ¿å›¾(éœ€å¯ç”¨åç»­å­˜å‚¨)

      - name: ğŸ“ˆ Store Results
        uses: actions/upload-artifact@v4
        with:
          name: zap-results-${{ github.run_id }}
          path: |
            zap_scan.log
            zap-report.*
            trending.png  # å®‰å…¨è¶‹åŠ¿å›¾
